# üè• KOK - Plateforme de Prise de Rendez-vous

Application web compl√®te de prise de rendez-vous pour th√©rapie sensorimotrice, inspir√©e de Doctolib/Resaclick.

## üìã Table des mati√®res

- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [Architecture](#-architecture)
- [Technologies](#-technologies)
- [Installation](#-installation)
- [Configuration](#-configuration)
- [D√©marrage](#-d√©marrage)
- [API Endpoints](#-api-endpoints)
- [Tests](#-tests)
- [D√©ploiement](#-d√©ploiement)
- [RGPD & S√©curit√©](#-rgpd--s√©curit√©)
- [Licence](#-licence)

## ‚ú® Fonctionnalit√©s

### Patients
- ‚úÖ Inscription et connexion s√©curis√©es
- ‚úÖ Prise de rendez-vous en ligne
- ‚úÖ Consultation des cr√©neaux disponibles
- ‚úÖ Gestion des rendez-vous (modification, annulation >24h)
- ‚úÖ Notifications par email (confirmation, rappels)
- ‚úÖ Export et suppression des donn√©es (RGPD)
- ‚úÖ Profil utilisateur modifiable

### Administrateur
- ‚úÖ Gestion compl√®te des disponibilit√©s
- ‚úÖ Plages horaires r√©currentes configurables
- ‚úÖ Gestion des exceptions (cong√©s, ouvertures exceptionnelles)
- ‚úÖ Vue calendrier (jour/semaine/mois)
- ‚úÖ Liste et gestion de tous les rendez-vous
- ‚úÖ Cr√©ation de rendez-vous pour les patients
- ‚úÖ Export des donn√©es (CSV)
- ‚úÖ Logs d'audit

## üèóÔ∏è Architecture

```
kok/
‚îú‚îÄ‚îÄ backend/          # API REST Node.js + Express + TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/       # Configuration (DB, logger)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/  # Contr√¥leurs API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/   # Middlewares (auth, validation, rate limit)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/       # Mod√®les TypeScript
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/       # Routes API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/     # Services (email, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/   # Migrations SQL
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts      # Point d'entr√©e
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ frontend/         # SPA Next.js + React + TailwindCSS
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/          # Pages Next.js (App Router)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/   # Composants React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/     # Services API (Axios)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stores/       # State management (Zustand)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types/        # Types TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îî‚îÄ‚îÄ ci.yml        # Pipeline CI/CD
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .env.example
‚îî‚îÄ‚îÄ README.md
```

## üõ†Ô∏è Technologies

### Backend
- **Runtime**: Node.js 20 LTS
- **Framework**: Express.js
- **Langage**: TypeScript
- **Base de donn√©es**: PostgreSQL 16
- **ORM**: pg (client PostgreSQL natif)
- **Authentification**: JWT + bcrypt
- **Validation**: Joi
- **Email**: Nodemailer
- **Logging**: Winston
- **Tests**: Jest + Supertest

### Frontend
- **Framework**: Next.js 14 (App Router)
- **UI**: React 18
- **Styling**: TailwindCSS
- **HTTP Client**: Axios
- **State Management**: Zustand
- **Notifications**: React Hot Toast
- **Date Handling**: date-fns
- **Tests**: Jest + React Testing Library

### DevOps
- **Conteneurisation**: Docker + Docker Compose
- **CI/CD**: GitHub Actions
- **Linting**: ESLint + Prettier
- **S√©curit√©**: Helmet, CORS, Rate Limiting

## üì¶ Installation

### Pr√©requis
- Node.js 20+ et npm
- Docker et Docker Compose
- PostgreSQL 16 (si installation sans Docker)
- Git

### Cloner le projet
```bash
git clone https://github.com/doriansarry47-creator/kok.git
cd kok
```

### Configuration
```bash
# Copier le fichier d'environnement
cp .env.example .env

# √âditer .env avec vos valeurs
nano .env
```

### Variables d'environnement essentielles

‚ö†Ô∏è **IMPORTANT** : Modifiez ces valeurs en production :

```env
# Base de donn√©es
DATABASE_URL=postgresql://kok_user:kok_password@localhost:5432/kok

# S√©curit√©
JWT_SECRET=votre-secret-jwt-super-securise-changez-moi-absolument

# Admin par d√©faut
ADMIN_EMAIL=admin@therapie-sensorimotrice.fr
ADMIN_PASSWORD=Admin123!  # ‚ö†Ô∏è √Ä changer apr√®s premi√®re connexion

# SMTP (emails)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=votre-email@gmail.com
SMTP_PASS=votre-mot-de-passe-application
```

## üöÄ D√©marrage

### Avec Docker (Recommand√©)

```bash
# Construire et d√©marrer tous les services
docker-compose up -d

# V√©rifier les logs
docker-compose logs -f

# Services disponibles:
# - Backend API: http://localhost:3000
# - Frontend: http://localhost:3001
# - PostgreSQL: localhost:5432
```

### Initialisation de la base de donn√©es

```bash
# Ex√©cuter les migrations (premi√®re fois uniquement)
docker-compose exec backend npm run migrate

# Cr√©er le compte admin et donn√©es par d√©faut
docker-compose exec backend npm run seed
```

### Sans Docker (D√©veloppement local)

#### Backend
```bash
cd backend

# Installer les d√©pendances
npm install

# Ex√©cuter les migrations
npm run migrate

# Initialiser les donn√©es
npm run seed

# D√©marrer en mode d√©veloppement
npm run dev
```

#### Frontend
```bash
cd frontend

# Installer les d√©pendances
npm install

# D√©marrer en mode d√©veloppement
npm run dev
```

## üîå API Endpoints

### Authentification
```
POST   /api/auth/register          # Inscription patient
POST   /api/auth/login             # Connexion
GET    /api/auth/me                # Profil utilisateur (auth)
PUT    /api/auth/me                # Modifier profil (auth)
DELETE /api/auth/me                # Supprimer compte (auth)
GET    /api/auth/me/export         # Exporter donn√©es RGPD (auth)
```

### Disponibilit√©s
```
GET    /api/availability           # Liste disponibilit√©s (auth)
GET    /api/availability/slots     # Cr√©neaux disponibles (auth)
POST   /api/availability           # Cr√©er disponibilit√© (admin)
PUT    /api/availability/:id       # Modifier disponibilit√© (admin)
DELETE /api/availability/:id       # Supprimer disponibilit√© (admin)
GET    /api/availability/exceptions # Liste exceptions (admin)
POST   /api/availability/exceptions # Cr√©er exception (admin)
DELETE /api/availability/exceptions/:id # Supprimer exception (admin)
```

### R√©servations
```
POST   /api/bookings               # Cr√©er rendez-vous (patient)
GET    /api/bookings/my            # Mes rendez-vous (patient)
GET    /api/bookings/:id           # D√©tails rendez-vous (auth)
PUT    /api/bookings/:id           # Modifier rendez-vous (auth)
POST   /api/bookings/:id/cancel    # Annuler rendez-vous (auth)
GET    /api/bookings               # Tous les rendez-vous (admin)
POST   /api/bookings/admin/create  # Cr√©er pour patient (admin)
```

## üß™ Tests

### Backend
```bash
cd backend

# Tous les tests
npm test

# Tests avec couverture
npm test -- --coverage

# Tests en mode watch
npm run test:watch

# Linting
npm run lint
```

### Frontend
```bash
cd frontend

# Tous les tests
npm test

# Linting
npm run lint
```

## üìä Base de donn√©es

### Sch√©ma principal

#### Table `users`
```sql
- id (UUID, PK)
- email (VARCHAR, UNIQUE)
- password_hash (VARCHAR)
- role (ENUM: admin, patient)
- first_name, last_name, phone
- is_active (BOOLEAN)
- created_at, updated_at, last_login
```

#### Table `availabilities`
```sql
- id (UUID, PK)
- day_of_week (INTEGER 0-6)
- start_time, end_time (TIME)
- slot_duration (INTEGER, minutes)
- is_active (BOOLEAN)
```

#### Table `bookings`
```sql
- id (UUID, PK)
- patient_id (UUID, FK ‚Üí users)
- date (DATE)
- start_time, end_time (TIME)
- status (ENUM: pending, confirmed, cancelled, completed)
- reason, cancellation_reason (TEXT)
- created_at, updated_at, cancelled_at
```

### Migrations

```bash
# Appliquer les migrations
docker-compose exec backend npm run migrate

# R√©initialiser la base (d√©veloppement uniquement)
docker-compose down -v
docker-compose up -d
docker-compose exec backend npm run migrate
docker-compose exec backend npm run seed
```

## üö¢ D√©ploiement

### Pr√©parer la production

1. **Modifier les variables d'environnement**
```bash
# G√©n√©rer un secret JWT fort
openssl rand -base64 32

# Utiliser une base de donn√©es PostgreSQL en production
# Exemple avec Neon (fourni dans les credentials)
DATABASE_URL=postgresql://neondb_owner:npg_...@ep-young-darkness-...pooler.eu-west-2.aws.neon.tech/neondb?sslmode=require
```

2. **Build des images Docker**
```bash
# Backend
docker build -t kok-backend:production ./backend

# Frontend
docker build -t kok-frontend:production \
  --build-arg NEXT_PUBLIC_API_URL=https://api.votre-domaine.com \
  ./frontend
```

3. **D√©ployer avec docker-compose**
```bash
# En production
NODE_ENV=production docker-compose up -d
```

### CI/CD avec GitHub Actions

Le pipeline CI/CD s'ex√©cute automatiquement :
- ‚úÖ Lint et tests sur chaque push
- ‚úÖ Build Docker sur merge vers `main`
- ‚úÖ Scan de s√©curit√© (Trivy)
- ‚úÖ D√©ploiement automatique (√† configurer)

### Options de d√©ploiement
- **VPS/VM**: Docker Compose + Nginx reverse proxy
- **Cloud**: AWS ECS, Google Cloud Run, Azure Container Instances
- **Platform as a Service**: Render, Railway, Heroku
- **Kubernetes**: Helm charts disponibles sur demande

## üîí RGPD & S√©curit√©

### Conformit√© RGPD
- ‚úÖ Export des donn√©es utilisateur (JSON)
- ‚úÖ Suppression/anonymisation du compte
- ‚úÖ Logs limit√©s √† 14 jours (auto-nettoyage)
- ‚úÖ Minimisation des donn√©es collect√©es
- ‚úÖ Consentement explicite (conditions d'utilisation)
- ‚úÖ Audit logs pour tra√ßabilit√©

### S√©curit√©
- ‚úÖ Mots de passe hash√©s (bcrypt, cost 12)
- ‚úÖ JWT avec expiration (7 jours)
- ‚úÖ Rate limiting anti brute-force
- ‚úÖ Helmet pour headers HTTP s√©curis√©s
- ‚úÖ CORS configur√©
- ‚úÖ Validation stricte des entr√©es (Joi)
- ‚úÖ Sanitization SQL (parameterized queries)
- ‚úÖ HTTPS obligatoire en production

### Recommandations production
1. Activer HTTPS avec certificat SSL/TLS
2. Utiliser des secrets forts (>32 caract√®res)
3. Configurer un firewall
4. Mettre en place des sauvegardes automatiques
5. Monitorer les logs d'erreur
6. Activer 2FA pour les comptes admin (optionnel)
7. Scanner r√©guli√®rement les vuln√©rabilit√©s

## üìù Compte admin par d√©faut

Lors de l'initialisation (seed), un compte admin est cr√©√© :

```
Email: admin@therapie-sensorimotrice.fr
Mot de passe: Admin123!
```

‚ö†Ô∏è **IMPORTANT** : Changez le mot de passe admin imm√©diatement apr√®s la premi√®re connexion !

## üêõ Troubleshooting

### Probl√®mes fr√©quents

**Erreur de connexion √† la base de donn√©es**
```bash
# V√©rifier que PostgreSQL est d√©marr√©
docker-compose ps

# V√©rifier les logs
docker-compose logs postgres

# V√©rifier DATABASE_URL dans .env
```

**Port d√©j√† utilis√©**
```bash
# Modifier les ports dans .env
BACKEND_PORT=3002
FRONTEND_PORT=3003
```

**Erreur d'email**
```bash
# V√©rifier la configuration SMTP
# Pour Gmail, cr√©er un "mot de passe d'application"
# https://support.google.com/accounts/answer/185833
```

## üìÑ Licence

MIT License - voir [LICENSE](LICENSE)

## üë• Contribution

Les contributions sont les bienvenues ! Veuillez :
1. Forker le projet
2. Cr√©er une branche (`git checkout -b feature/AmazingFeature`)
3. Commit (`git commit -m 'Add AmazingFeature'`)
4. Push (`git push origin feature/AmazingFeature`)
5. Ouvrir une Pull Request

## üìû Support

Pour toute question ou probl√®me :
- üìß Email: admin@therapie-sensorimotrice.fr
- üêõ Issues GitHub: [https://github.com/doriansarry47-creator/kok/issues](https://github.com/doriansarry47-creator/kok/issues)

## üéâ Remerciements

D√©velopp√© avec ‚ù§Ô∏è pour la communaut√© de th√©rapie sensorimotrice.

---

**Version**: 1.0.0  
**Derni√®re mise √† jour**: 2025-01-15
