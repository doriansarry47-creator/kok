# üëë Guide Administrateur - KOK

## üìã Table des mati√®res

- [Connexion](#-connexion)
- [Vue d'ensemble](#-vue-densemble)
- [Tableau de bord](#-tableau-de-bord)
- [Gestion des rendez-vous](#-gestion-des-rendez-vous)
- [Gestion des disponibilit√©s](#-gestion-des-disponibilit√©s)
- [Gestion des patients](#-gestion-des-patients)
- [Param√®tres du cabinet](#Ô∏è-param√®tres-du-cabinet)
- [S√©curit√©](#-s√©curit√©)
- [API Backend](#-api-backend)
- [Configuration](#Ô∏è-configuration)
- [D√©ploiement](#-d√©ploiement)
- [Troubleshooting](#-troubleshooting)

---

## üîê Connexion

### Acc√®s au panneau administrateur

**URL de connexion** : `http://localhost:3001/admin/login` (ou votre domaine en production)

### Comptes administrateurs par d√©faut

#### Compte principal
```
Email: doriansarry@yahoo.fr
Mot de passe: admin123
```

#### Compte secondaire (configurable via .env)
```
Email: admin@therapie-sensorimotrice.fr
Mot de passe: Admin123!
```

> ‚ö†Ô∏è **IMPORTANT** : Changez ces mots de passe imm√©diatement apr√®s la premi√®re connexion !

### Premi√®re connexion

1. Acc√©dez √† `/admin/login`
2. Entrez vos identifiants administrateur
3. Cliquez sur "Se connecter"
4. Vous serez redirig√© vers le tableau de bord

---

## üìä Vue d'ensemble

Le panneau administrateur de KOK vous permet de g√©rer int√©gralement votre cabinet de th√©rapie sensorimotrice :

### Fonctionnalit√©s principales

- ‚úÖ **Dashboard** : Vue d'ensemble en temps r√©el de l'activit√©
- ‚úÖ **Rendez-vous** : Gestion compl√®te des cr√©neaux r√©serv√©s
- ‚úÖ **Disponibilit√©s** : Configuration de vos horaires de travail
- ‚úÖ **Patients** : Base de donn√©es compl√®te de vos patients
- ‚úÖ **Param√®tres** : Configuration du cabinet et s√©curit√©
- ‚úÖ **Export CSV** : Exportation des donn√©es pour analyse
- ‚úÖ **Logs d'audit** : Tra√ßabilit√© compl√®te des actions

### Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           Interface Administrateur          ‚îÇ
‚îÇ                (React + Next.js)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îÇ JWT Authentication
                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              API Backend                    ‚îÇ
‚îÇ            (Node.js + Express)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ
                  ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Base de donn√©es PostgreSQL         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä Tableau de bord

**Route** : `/admin/dashboard`

### Statistiques affich√©es

#### 1. Patients total
- Nombre total de patients actifs inscrits
- Ic√¥ne : üë•

#### 2. RDV √† venir (7 jours)
- Nombre de rendez-vous confirm√©s dans les 7 prochains jours
- Ic√¥ne : üìÖ

#### 3. RDV aujourd'hui
- Nombre de rendez-vous pr√©vus aujourd'hui
- Ic√¥ne : üìÜ

#### 4. Annulations r√©centes (7 jours)
- Nombre d'annulations dans les 7 derniers jours
- Ic√¥ne : ‚ùå

### Rendez-vous du jour

Section d√©taill√©e affichant tous les rendez-vous d'aujourd'hui avec :
- Avatar du patient
- Nom et pr√©nom
- Email de contact
- T√©l√©phone
- Horaire (heure de d√©but - heure de fin)
- Statut (badge color√©)

**Actualisation** : Les donn√©es sont charg√©es automatiquement √† l'ouverture de la page.

---

## üìÖ Gestion des rendez-vous

**Route** : `/admin/rendez-vous`

### Vue liste

Tableau complet de tous les rendez-vous avec les colonnes suivantes :

| Colonne | Description |
|---------|-------------|
| **Patient** | Nom, pr√©nom et email |
| **Date** | Date du rendez-vous |
| **Horaire** | Heure de d√©but - heure de fin |
| **Statut** | Badge color√© (confirm√©, en attente, annul√©, termin√©) |
| **Contact** | Num√©ro de t√©l√©phone |
| **Actions** | Boutons d'action (voir d√©tails, modifier, annuler) |

### Filtres disponibles

```javascript
// Filtrer par statut
status: 'confirmed' | 'pending' | 'cancelled' | 'completed'

// Filtrer par p√©riode
date_from: 'YYYY-MM-DD'
date_to: 'YYYY-MM-DD'

// Recherche par patient
patient_id: 'uuid'
```

### Actions possibles

#### 1. Cr√©er un rendez-vous

**Bouton** : "Nouveau rendez-vous"

**Formulaire** :
- S√©lection du patient (liste d√©roulante)
- Date du rendez-vous
- Heure de d√©but
- Heure de fin
- Motif (optionnel)

**Validation** :
- V√©rification que le cr√©neau n'est pas d√©j√† r√©serv√©
- V√©rification que le patient existe
- Email de confirmation automatique envoy√© au patient

#### 2. Modifier un rendez-vous

**API** : `PUT /api/admin/bookings/:id`

**Champs modifiables** :
- Date
- Heure de d√©but
- Heure de fin
- Statut
- Motif

> ‚ö†Ô∏è Les admins peuvent modifier un rendez-vous sans contrainte de d√©lai (contrairement aux patients qui ont une limite de 24h)

#### 3. Annuler un rendez-vous

**API** : `POST /api/admin/bookings/:id/cancel`

**Formulaire** :
- Raison de l'annulation (optionnel)

**Cons√©quences** :
- Statut du rendez-vous chang√© en "cancelled"
- Date/heure d'annulation enregistr√©e
- Email automatique envoy√© au patient
- Log d'audit cr√©√©

### Export CSV

**Bouton** : "Exporter en CSV"

**Filtres appliqu√©s** :
- Par d√©faut : tous les rendez-vous
- Possibilit√© de filtrer par p√©riode

**Colonnes export√©es** :
```csv
Date,Heure d√©but,Heure fin,Statut,Patient pr√©nom,Patient nom,Email,T√©l√©phone,Motif
```

**Nom du fichier** : `rendez-vous.csv`

---

## üïê Gestion des disponibilit√©s

**Route** : `/admin/disponibilites`

### Vue hebdomadaire

Affichage des plages horaires par jour de la semaine :

```
Lundi       Mardi       Mercredi    Jeudi       Vendredi    Samedi      Dimanche
[Plages]    [Plages]    [Plages]    [Plages]    [Plages]    [Plages]    [Plages]
```

### Structure des plages horaires

Chaque plage affiche :
- **Horaire** : Ex. "09:00 - 12:00"
- **Dur√©e des cr√©neaux** : Ex. "45 minutes"
- **Statut** : Actif (vert) / Inactif (gris)
- **Actions** : Activer/D√©sactiver, Supprimer

### Cr√©er une plage horaire

**API** : `POST /api/availability`

**Formulaire** :
```json
{
  "day_of_week": 1,          // 0 = Dimanche, 1 = Lundi, ..., 6 = Samedi
  "start_time": "09:00",
  "end_time": "12:00",
  "slot_duration": 45,       // en minutes
  "is_active": true
}
```

**Validation** :
- `start_time` doit √™tre avant `end_time`
- `slot_duration` : entre 15 et 120 minutes
- Pas de chevauchement avec une plage existante sur le m√™me jour

### Modifier une plage horaire

**API** : `PUT /api/availability/:id`

**Champs modifiables** :
- Heure de d√©but
- Heure de fin
- Dur√©e des cr√©neaux
- Statut actif/inactif

### Activer/D√©sactiver une plage

**Toggle rapide** : Bouton pour activer/d√©sactiver sans supprimer

**Utilit√©** :
- Garder la configuration pour une r√©activation future
- D√©sactiver temporairement un cr√©neau

### Supprimer une plage

**Confirmation requise** : "√ätes-vous s√ªr de vouloir supprimer cette plage horaire ?"

> ‚ö†Ô∏è La suppression est d√©finitive. Pr√©f√©rez la d√©sactivation pour une indisponibilit√© temporaire.

### Gestion des exceptions

**√Ä venir** : Gestion des cong√©s, jours f√©ri√©s et ouvertures exceptionnelles

---

## üë§ Gestion des patients

**Route** : `/admin/patients`

### Vue liste

Tableau de tous les patients avec :

| Colonne | Description |
|---------|-------------|
| **Avatar** | Initiale du pr√©nom dans un cercle |
| **Nom complet** | Pr√©nom et nom |
| **Email** | Adresse email |
| **T√©l√©phone** | Num√©ro de contact |
| **Inscrit le** | Date de cr√©ation du compte |
| **RDV** | Nombre total de rendez-vous |
| **Actions** | Boutons d'action |

### Recherche

**Barre de recherche** : Recherche en temps r√©el sur :
- Nom
- Pr√©nom
- Email
- T√©l√©phone

**API** : `GET /api/admin/patients?search=jean`

### Actions possibles

#### 1. Voir le d√©tail d'un patient

**Informations affich√©es** :
- Identit√© compl√®te
- Coordonn√©es
- Date d'inscription
- Date de derni√®re connexion
- Historique des rendez-vous
- Statut du compte (actif/inactif)

#### 2. Supprimer un patient

**API** : `DELETE /api/admin/patients/:id`

**Confirmation requise** : Modale avec message d'avertissement

**Cons√©quences** :
- Suppression d√©finitive du compte
- Suppression en cascade de tous ses rendez-vous
- Respect du RGPD (droit √† l'oubli)
- Log d'audit cr√©√©

> ‚ö†Ô∏è **ATTENTION** : Cette action est irr√©versible !

### Export CSV

**Bouton** : "Exporter la liste"

**Colonnes export√©es** :
```csv
Email,Pr√©nom,Nom,T√©l√©phone,Date inscription,Nombre RDV
```

**Nom du fichier** : `patients.csv`

**Utilit√©** :
- Analyse externe (Excel, Google Sheets)
- Sauvegarde des donn√©es
- Campagnes email (avec consentement)

---

## ‚öôÔ∏è Param√®tres du cabinet

**Route** : `/admin/parametres`

### Informations g√©n√©rales

**API** : `GET /api/admin/settings`

#### Champs configurables

| Champ | Type | Description |
|-------|------|-------------|
| **cabinet_name** | Texte | Nom affich√© du cabinet |
| **address** | Textarea | Adresse postale compl√®te |
| **contact_email** | Email | Email de contact public |
| **contact_phone** | Tel | Num√©ro de t√©l√©phone du cabinet |
| **logo_url** | URL | Lien vers le logo (optionnel) |

### Options de fonctionnement

#### Notifications

| Option | Par d√©faut | Description |
|--------|-----------|-------------|
| **notification_enabled** | `true` | Activer l'envoi d'emails automatiques |
| **reminder_days_before** | `1` | Nombre de jours avant le RDV pour le rappel |

#### R√©servations

| Option | Par d√©faut | Description |
|--------|-----------|-------------|
| **allow_online_booking** | `true` | Autoriser les patients √† prendre RDV en ligne |
| **slot_duration_default** | `60` | Dur√©e par d√©faut des cr√©neaux (minutes) |

### Sauvegarde des param√®tres

**API** : `PUT /api/admin/settings`

**Validation** :
- Email valide
- T√©l√©phone au format international ou local
- Dur√©e des cr√©neaux : 15-120 minutes

**Confirmation** : Message de succ√®s "Param√®tres enregistr√©s avec succ√®s"

---

## üîí S√©curit√©

**Route** : `/admin/parametres` (section S√©curit√©)

### Changement de mot de passe

**API** : `PUT /api/admin/security/password`

**Formulaire** :
```json
{
  "current_password": "ancien_mot_de_passe",
  "new_password": "nouveau_mot_de_passe",
  "confirm_password": "nouveau_mot_de_passe"
}
```

**Validation** :
- ‚úÖ Mot de passe actuel correct
- ‚úÖ Nouveau mot de passe ‚â• 8 caract√®res
- ‚úÖ Confirmation identique au nouveau mot de passe
- ‚úÖ Nouveau mot de passe diff√©rent de l'ancien

**R√®gles de s√©curit√©** :
- **Longueur minimale** : 8 caract√®res
- **Recommand√©** : 12+ caract√®res avec majuscules, minuscules, chiffres et symboles

**Cons√©quences** :
- Mot de passe hach√© avec bcrypt (cost 12)
- Log d'audit cr√©√©
- Session actuelle maintenue (pas de d√©connexion)

### Authentification

#### Syst√®me JWT

**Tokens** :
- **Access Token** : Dur√©e de vie 7 jours
- Stockage : `localStorage` (c√¥t√© client)
- Format : `Bearer <token>`

**D√©connexion** :
- Suppression du token c√¥t√© client
- Redirection vers `/admin/login`

#### Protection des routes

**Middleware** : `authenticate` + `requireRole('admin')`

**V√©rifications** :
1. Pr√©sence du token
2. Validit√© du token (signature + expiration)
3. R√¥le "admin" dans le payload

**Erreurs possibles** :
- `401 Unauthorized` : Token manquant ou invalide
- `403 Forbidden` : R√¥le insuffisant

### Logs d'audit

**Table** : `audit_logs`

**√âv√©nements enregistr√©s** :
- ‚úÖ Cr√©ation de rendez-vous par l'admin
- ‚úÖ Modification de rendez-vous
- ‚úÖ Annulation de rendez-vous
- ‚úÖ Suppression de patient
- ‚úÖ Modification des param√®tres
- ‚úÖ Changement de mot de passe
- ‚úÖ Modification des disponibilit√©s

**Donn√©es enregistr√©es** :
```javascript
{
  id: 'uuid',
  user_id: 'uuid',              // Admin ayant effectu√© l'action
  action: 'ACTION_TYPE',         // Type d'action
  resource_type: 'booking',      // Type de ressource
  resource_id: 'uuid',           // ID de la ressource
  details: { ... },              // D√©tails JSON
  ip_address: '192.168.1.1',    // IP du client
  created_at: 'timestamp'
}
```

**Consultation des logs** :
```sql
SELECT * FROM audit_logs 
WHERE user_id = 'admin_id' 
ORDER BY created_at DESC 
LIMIT 100;
```

**R√©tention** : Les logs sont conserv√©s 14 jours (conformit√© RGPD)

---

## üîå API Backend

### Routes administrateur

Toutes les routes sont pr√©fix√©es par `/api/admin` et n√©cessitent :
- Header : `Authorization: Bearer <token>`
- R√¥le : `admin`

### Dashboard

```
GET /api/admin/dashboard
```

**R√©ponse** :
```json
{
  "success": true,
  "data": {
    "totalPatients": 42,
    "upcomingBookings": 15,
    "todayBookings": [
      {
        "id": "uuid",
        "patient_first_name": "Jean",
        "patient_last_name": "Dupont",
        "patient_email": "jean@example.com",
        "patient_phone": "0612345678",
        "date": "2025-10-29",
        "start_time": "10:00:00",
        "end_time": "11:00:00",
        "status": "confirmed"
      }
    ],
    "recentCancellations": 3
  }
}
```

### Rendez-vous

#### Lister tous les rendez-vous
```
GET /api/admin/bookings
GET /api/admin/bookings?status=confirmed
GET /api/admin/bookings?date_from=2025-10-01&date_to=2025-10-31
```

#### Cr√©er un rendez-vous
```
POST /api/admin/bookings
Content-Type: application/json

{
  "patient_id": "uuid",
  "date": "2025-11-15",
  "start_time": "10:00",
  "end_time": "11:00",
  "reason": "S√©ance de suivi"
}
```

#### Modifier un rendez-vous
```
PUT /api/admin/bookings/:id
Content-Type: application/json

{
  "date": "2025-11-16",
  "start_time": "14:00",
  "end_time": "15:00",
  "status": "confirmed"
}
```

#### Annuler un rendez-vous
```
POST /api/admin/bookings/:id/cancel
Content-Type: application/json

{
  "cancellation_reason": "Indisponibilit√© du th√©rapeute"
}
```

#### Exporter en CSV
```
GET /api/admin/bookings/export/csv
GET /api/admin/bookings/export/csv?date_from=2025-10-01&date_to=2025-10-31
```

### Patients

#### Lister tous les patients
```
GET /api/admin/patients
GET /api/admin/patients?search=jean
```

**R√©ponse** :
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "email": "jean@example.com",
      "first_name": "Jean",
      "last_name": "Dupont",
      "phone": "0612345678",
      "created_at": "2025-01-15T10:00:00Z",
      "last_login": "2025-10-28T15:30:00Z",
      "is_active": true,
      "total_bookings": 5
    }
  ]
}
```

#### Supprimer un patient
```
DELETE /api/admin/patients/:id
```

#### Exporter en CSV
```
GET /api/admin/patients/export/csv
```

### Disponibilit√©s

#### Lister les disponibilit√©s
```
GET /api/availability
```

#### Cr√©er une disponibilit√©
```
POST /api/availability
Content-Type: application/json

{
  "day_of_week": 1,
  "start_time": "09:00",
  "end_time": "12:00",
  "slot_duration": 45,
  "is_active": true
}
```

#### Modifier une disponibilit√©
```
PUT /api/availability/:id
Content-Type: application/json

{
  "start_time": "09:30",
  "end_time": "12:30",
  "is_active": false
}
```

#### Supprimer une disponibilit√©
```
DELETE /api/availability/:id
```

### Param√®tres

#### Obtenir les param√®tres
```
GET /api/admin/settings
```

#### Mettre √† jour les param√®tres
```
PUT /api/admin/settings
Content-Type: application/json

{
  "cabinet_name": "Cabinet de Th√©rapie Sensorimotrice",
  "address": "10 rue de la Sant√©, 75014 Paris",
  "contact_email": "contact@therapie.fr",
  "contact_phone": "0145678901",
  "notification_enabled": true,
  "allow_online_booking": true,
  "slot_duration_default": 60
}
```

### S√©curit√©

#### Changer le mot de passe
```
PUT /api/admin/security/password
Content-Type: application/json

{
  "current_password": "ancien_mdp",
  "new_password": "nouveau_mdp_securise"
}
```

---

## ‚öôÔ∏è Configuration

### Variables d'environnement

Fichier `.env` √† la racine du projet :

```env
# === BASE DE DONN√âES ===
DATABASE_URL=postgresql://kok_user:kok_password@localhost:5432/kok

# === S√âCURIT√â ===
JWT_SECRET=votre-secret-jwt-super-securise-changez-moi-absolument
# G√©n√©rer un secret fort : openssl rand -base64 32

# === ADMIN PAR D√âFAUT ===
# Note: le compte doriansarry@yahoo.fr est cr√©√© en dur dans le seed
ADMIN_EMAIL=admin@therapie-sensorimotrice.fr
ADMIN_PASSWORD=Admin123!

# === SMTP (Emails) ===
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=votre-email@gmail.com
SMTP_PASS=votre-mot-de-passe-application
FROM_EMAIL=noreply@therapie-sensorimotrice.fr

# === FRONTEND ===
NEXT_PUBLIC_API_URL=http://localhost:3000

# === PORTS ===
BACKEND_PORT=3000
FRONTEND_PORT=3001
POSTGRES_PORT=5432

# === ENVIRONNEMENT ===
NODE_ENV=development
```

### Configuration SMTP (Gmail)

Pour utiliser Gmail comme serveur SMTP :

1. Activer la validation en 2 √©tapes
2. G√©n√©rer un "mot de passe d'application" :
   - Aller sur : https://myaccount.google.com/security
   - Section "Validation en deux √©tapes"
   - "Mots de passe des applications"
   - Cr√©er un mot de passe pour "Application personnalis√©e"
3. Utiliser ce mot de passe dans `SMTP_PASS`

---

## üöÄ D√©ploiement

### Installation initiale

#### 1. Cloner le projet
```bash
git clone https://github.com/doriansarry47-creator/kok.git
cd kok
```

#### 2. Configurer les variables d'environnement
```bash
cp .env.example .env
nano .env  # √âditer avec vos valeurs
```

#### 3. Avec Docker (recommand√©)
```bash
# D√©marrer tous les services
docker-compose up -d

# V√©rifier les logs
docker-compose logs -f

# Ex√©cuter les migrations
docker-compose exec backend npm run migrate

# Initialiser les donn√©es (cr√©e les comptes admin)
docker-compose exec backend npm run seed
```

#### 4. Sans Docker
```bash
# Backend
cd backend
npm install
npm run migrate
npm run seed
npm run dev

# Frontend (dans un autre terminal)
cd frontend
npm install
npm run dev
```

### Acc√®s aux services

- **Backend API** : http://localhost:3000
- **Frontend** : http://localhost:3001
- **Admin Panel** : http://localhost:3001/admin/login
- **PostgreSQL** : localhost:5432

### Production

#### Build des images Docker

```bash
# Backend
docker build -t kok-backend:production ./backend

# Frontend
docker build -t kok-frontend:production \
  --build-arg NEXT_PUBLIC_API_URL=https://api.votre-domaine.com \
  ./frontend
```

#### D√©ploiement

```bash
# Avec docker-compose
NODE_ENV=production docker-compose up -d

# V√©rifier les logs
docker-compose logs -f backend
docker-compose logs -f frontend
```

### Recommandations production

1. **Base de donn√©es** :
   - Utiliser une base PostgreSQL manag√©e (AWS RDS, GCP Cloud SQL, Neon, Supabase)
   - Sauvegardes automatiques quotidiennes
   - R√©plication si haute disponibilit√© requise

2. **Secrets** :
   - G√©n√©rer un nouveau `JWT_SECRET` fort (32+ caract√®res)
   - Ne jamais commit de `.env` dans git
   - Utiliser des variables d'environnement s√©curis√©es (secrets manager)

3. **HTTPS** :
   - Certificat SSL/TLS obligatoire (Let's Encrypt, Cloudflare)
   - Redirection HTTP ‚Üí HTTPS automatique

4. **Reverse Proxy** :
   - Nginx ou Traefik devant les services
   - Rate limiting
   - Compression gzip/brotli

5. **Monitoring** :
   - Logs centralis√©s (ELK, Loki, Datadog)
   - Alertes sur erreurs critiques
   - M√©triques de performance

---

## üêõ Troubleshooting

### Probl√®me : Impossible de se connecter

**Sympt√¥mes** :
- Message "Email ou mot de passe incorrect"
- Le formulaire ne r√©pond pas

**Solutions** :
1. V√©rifier que le backend est d√©marr√© :
   ```bash
   docker-compose ps
   # backend doit √™tre "Up"
   ```

2. V√©rifier que le seed a √©t√© ex√©cut√© :
   ```bash
   docker-compose exec backend npm run seed
   ```

3. R√©initialiser le mot de passe admin :
   ```bash
   # Se connecter √† PostgreSQL
   docker-compose exec postgres psql -U kok_user -d kok
   
   # R√©initialiser le mot de passe (hash de "admin123")
   UPDATE users 
   SET password_hash = '$2b$12$...' 
   WHERE email = 'doriansarry@yahoo.fr';
   ```

### Probl√®me : Token invalide ou expir√©

**Sympt√¥mes** :
- D√©connexion automatique
- Message "Token invalide ou expir√©" sur toutes les requ√™tes

**Solutions** :
1. Se d√©connecter et se reconnecter
2. Vider le localStorage du navigateur :
   ```javascript
   localStorage.clear()
   ```
3. V√©rifier que `JWT_SECRET` est le m√™me entre backend et .env

### Probl√®me : Les donn√©es ne s'affichent pas

**Sympt√¥mes** :
- Dashboard vide
- Listes vides alors qu'il y a des donn√©es

**Solutions** :
1. Ouvrir la console du navigateur (F12)
2. V√©rifier les erreurs r√©seau (onglet Network)
3. V√©rifier que `NEXT_PUBLIC_API_URL` est correct
4. V√©rifier les CORS dans le backend :
   ```typescript
   // backend/src/index.ts
   app.use(cors({
     origin: 'http://localhost:3001',
     credentials: true
   }));
   ```

### Probl√®me : Erreur de connexion √† la base de donn√©es

**Sympt√¥mes** :
- Backend ne d√©marre pas
- Message "Connection refused" ou "ECONNREFUSED"

**Solutions** :
1. V√©rifier que PostgreSQL est d√©marr√© :
   ```bash
   docker-compose ps postgres
   ```

2. V√©rifier la variable `DATABASE_URL` :
   ```bash
   echo $DATABASE_URL
   ```

3. Tester la connexion manuellement :
   ```bash
   docker-compose exec postgres psql -U kok_user -d kok -c "SELECT 1"
   ```

4. R√©initialiser PostgreSQL :
   ```bash
   docker-compose down -v
   docker-compose up -d postgres
   docker-compose exec backend npm run migrate
   ```

### Probl√®me : Emails ne sont pas envoy√©s

**Sympt√¥mes** :
- Pas de confirmation apr√®s cr√©ation de RDV
- Logs montrent des erreurs SMTP

**Solutions** :
1. V√©rifier la configuration SMTP dans `.env`
2. Tester avec un serveur SMTP de d√©veloppement :
   ```bash
   # Utiliser Mailtrap ou MailHog pour les tests
   SMTP_HOST=smtp.mailtrap.io
   SMTP_PORT=2525
   SMTP_USER=your_mailtrap_user
   SMTP_PASS=your_mailtrap_pass
   ```

3. V√©rifier les logs backend :
   ```bash
   docker-compose logs backend | grep email
   ```

### Probl√®me : Port d√©j√† utilis√©

**Sympt√¥mes** :
- "Port 3000 is already in use"
- "EADDRINUSE"

**Solutions** :
1. Modifier les ports dans `.env` :
   ```env
   BACKEND_PORT=3002
   FRONTEND_PORT=3003
   ```

2. Ou tuer le processus utilisant le port :
   ```bash
   # Linux/Mac
   lsof -ti:3000 | xargs kill -9
   
   # Windows
   netstat -ano | findstr :3000
   taskkill /PID <PID> /F
   ```

### Probl√®me : Migrations √©chouent

**Sympt√¥mes** :
- "Migration failed"
- Erreur SQL

**Solutions** :
1. V√©rifier que la base existe :
   ```bash
   docker-compose exec postgres psql -U kok_user -l
   ```

2. R√©initialiser compl√®tement :
   ```bash
   # ATTENTION : Supprime toutes les donn√©es !
   docker-compose down -v
   docker-compose up -d
   docker-compose exec backend npm run migrate
   docker-compose exec backend npm run seed
   ```

3. Appliquer les migrations manuellement :
   ```bash
   docker-compose exec backend npm run migrate
   ```

---

## üìö Ressources suppl√©mentaires

### Documentation

- [README principal](./README.md)
- [Guide de d√©ploiement](./DEPLOYMENT.md)
- [Politique RGPD](./PRIVACY.md)

### Support

- üìß **Email** : doriansarry@yahoo.fr
- üêõ **Issues GitHub** : https://github.com/doriansarry47-creator/kok/issues

### Contribution

Les contributions sont les bienvenues ! Voir [CONTRIBUTING.md](./CONTRIBUTING.md)

---

## üéâ F√©licitations !

Vous √™tes maintenant pr√™t √† administrer votre cabinet de th√©rapie sensorimotrice avec KOK !

**Version** : 2.0.0  
**Derni√®re mise √† jour** : 2025-10-29  
**D√©velopp√© par** : Dorian Sarry

---

**¬© 2025 KOK - Tous droits r√©serv√©s**
